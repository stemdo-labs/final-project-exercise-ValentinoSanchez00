- name: Verificar si la base de datos existe
  hosts: bd
  vars:
    db_user: myuser
    db_password: mypassword
    db_host: localhost
    db_name: orquestas
  tasks:
    - name: Comprobar si la base de datos existe
      become: yes
      become_user: postgres
      shell: |
        PGPASSWORD={{ db_password }} psql -U {{ db_user }} -h {{ db_host }} -d {{ db_name }} -c '\q'
      register: db_check
      ignore_errors: yes

    - name: Configurar variable seg√∫n resultado
      set_fact:
        db_exists: "{{ 'true' if db_check.rc == 0 else 'false' }}"

    - name: Escribir la variable en un archivo para GitHub Actions
      copy:
        content: "DB_EXISTS={{ db_exists }}\n"
        dest: db_status.env
