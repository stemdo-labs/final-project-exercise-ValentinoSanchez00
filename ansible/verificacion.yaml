- name: Verificar si la base de datos existe
  hosts: bd
  tasks:
    - name: Comprobar si la base de datos existe
      # nO ME VA CON SECRETOS LO HE INTENTADO DE TODAS LAS FORMAS
      shell: |
        PGPASSWORD=mypassword psql -U myuser -d orquestas -h localhost -c '\q'
      register: db_check
      ignore_errors: yes

    - name: Configurar variable seg√∫n resultado
      set_fact:
        db_exists: "{{ 'true' if db_check.rc == 0 else 'false' }}"

    - name: Escribir la variable en un archivo para GitHub Actions
      copy:
        content: "DB_EXISTS={{ db_exists }}\n"
        dest: db_status.env